1.kafka-副本同步的方法入口在AbstracFetcherThread的dowork
2.dowork会调用maybeFetch方法,maybeFetch方法会通过partition根据partitionRequest请求
3.maybeFetch会根据partitionRequest请求执行processFetchRequest方法
4.processFetchRequest首先会执行fetchFromLeader方法,从Leader节点获取对应partition信息
具体实现是通过维护一个LeaderPartition的线程
5.processFetchRequest获取分区消息topicPartition的时候,会执行processPartitionData方法处理分区数据
6.processPartitionData在ReplicaFetcherThread类中定义
7.ReplicaFetcherThread.processPartitionData会根据Leader的partition信息更新本地的日志文件,具体的实现类为Log
8.更新本地日志文件之后更新本地的HighWatermark信息和LogStartOffent信息,在下次LEO消息中携带,用来Leader更新
对应的HW, hw对于consumer是可见的
9.leo消息会维护主节点的HW,ISR(in-sync replica,isr用来Leader节点dead后的节点选举)
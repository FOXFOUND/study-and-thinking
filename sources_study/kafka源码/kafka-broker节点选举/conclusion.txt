1.kafka启动过程中会调取kafkaServer的方法,在KafkaServer的方法里会调用KafkaController的startup方法
2.在KafkaController的startUp方法中会注册zk的监听事件
3.KafkaSapi会轮询的消息,根据消息类型判断是否是节点选举消息,当然也会有其他的消息,不同的消息进入不同的消息处理流程
4.如果是节点选举消息,则会调用kafkaApis的elecLeader方法,而elecLeader会调用replicaManager的elecLeader方法,最后
调用到KafkaController的elecLeader方法
5.KafkaController最终通过processReplicaLeaderElection方法处理选举消息
6.processReplicaLeaderElection判断节点当选逻辑是zk的路径注册是否存在,第一个注册成功的为Leader节点
7.当选Leader节点后会更新一些信息,如果previousLeader节点在zk中的Hw信息等;